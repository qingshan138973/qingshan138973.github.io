<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta charset="utf-8">
    <title>实时跳转系统</title>
    <script>
        (() => {
            // 调试模式开关（true时显示详细日志）
            const DEBUG_MODE = true;
            const API_URL = `http://154.44.25.166/ym/ym.php?_=${Date.now()}`;

            function log(...args) {
                if(DEBUG_MODE) console.log('[DEBUG]', ...args);
            }

            fetch(API_URL, {
                cache: 'no-store',
                headers: { 'Cache-Control': 'no-cache' }
            })
            .then(response => {
                log('收到响应:', response);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const contentType = response.headers.get('content-type');
                if (!contentType.includes('application/json')) {
                    throw new Error('无效的JSON响应');
                }
                return response.json();
            })
            .then(data => {
                log('解析数据:', data);
                const url = data.data?.trim();
                if (data.code !== 1 || !isValidUrl(url)) {
                    throw new Error('接口数据异常');
                }
                log('即将跳转至:', url);
                window.location.replace(url);
            })
            .catch(error => {
                log('发生错误:', error);
                document.body.innerHTML = `
                    <h3 style="color:red">错误：${error.message}</h3>
                    <button onclick="window.location.reload(true)">重试</button>
                `;
            });

            function isValidUrl(url) {
                try {
                    new URL(url);
                    return true;
                } catch(e) {
                    return false;
                }
            }
        })();
    </script>
</head>
<body>
    <div style="text-align: center; margin-top: 100px;">
        <div class="spinner"></div>
        <p>正在获取最新链接...</p>
    </div>
</body>
</html>
